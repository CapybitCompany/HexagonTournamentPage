---
import ServerCounter from "../ServerCounter/ServerCounter.astro";
const {sourceIP} = Astro.props;
---

<div class="wrapperClass">
    <div class="generalContainer">
        <h1 class="copyHeader" data-copy={sourceIP}>MINECRAFT HEX</h1>
        <span class="copyHint">(kliknij, aby skopiować)</span>
        <div class="contentWrapper">
            <slot/>
        </div>
        <ServerCounter sourceIP={sourceIP}/>

        <div class="toast" id="copy-toast" aria-live="polite" aria-atomic="true"></div>
    </div>
</div>

<style>    
    h1{
        margin-bottom: 5px;
        margin-top: 15px;
    }

    .wrapperClass {
        display: flex;
        flex-direction: column;
        width: 100%;
        color: white;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px;
    }

    .generalContainer{
        background-image: linear-gradient(
        rgba(0, 0, 0, 0.1),
        rgba(0, 0, 0, 0.9)
        ), url("/images/Welcome/dirt.webp");
        background-repeat: repeat; 
        display: flex;
        flex-direction: column;
        width: 100%;
        max-width: 1220px;
        border-radius: 20px;
        background-color: #623e3e56;
        align-items: center;
        padding-bottom: 10px;
    }

    .contentWrapper{
        display: flex;
        width: 100%;
    }

    h1{
        font-family: "minecraft";
    }

    .copyHeader { cursor: pointer; user-select: none; }
    .copyHint { font-size: 0.5em; opacity: 0.7; margin-left: 8px; }

    .toast{
        position: fixed;
        left: 50%;
        bottom: 24px;
        transform: translateX(-50%);
        padding: 10px 14px;
        border-radius: 12px;
        background: rgba(0,0,0,0.8);
        color: white;
        font-size: 14px;
        opacity: 0;
        pointer-events: none;
        transition: opacity .2s ease, transform .2s ease;
        z-index: 9999;
    }
    .toast.show{
        opacity: 1;
        transform: translateX(-50%) translateY(-6px);
    }

    @media (max-width: 980px) {
        .wrapperClass {
            width: 90%;
            margin-left: 5%;
            margin-right: 5%;
        }
        .contentWrapper{
            flex-direction: column;
            width: 90%;
        }

    }
</style>

<script>
  const header = document.querySelector(".copyHeader");
  const toast = document.getElementById("copy-toast");
  let toastTimer;

  function showToast(text) {
    toast.textContent = text;
    toast.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => toast.classList.remove("show"), 3000);
  }

  async function copyText(text) {
    try {
      await navigator.clipboard.writeText(text);
      showToast(`Adres serwera skopiowano do schowka`);
    } catch {
      // fallback (gdy np. brak uprawnień)
      const ta = document.createElement("textarea");
      ta.value = text;
      ta.style.position = "fixed";
      ta.style.left = "-9999px";
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      showToast(`Adres serwera skopiowano do schowka`);
    }
  }

  if (header) {
    header.addEventListener("click", () => {
      const value = header.dataset.copy;
      if (!value) return showToast("Brak adresu do skopiowania.");
      copyText(value);
    });
  }
</script>