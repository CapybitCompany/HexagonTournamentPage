---
import "../../styles/global.css";
import LogoIcon from "../../../public/logo.ico";
import NavBarItem from './NavBarItem.astro';
import MobileMenu from "./Mobile/MobileMenu.astro";
import MobileMenuHamburder from "./Mobile/MobileMenuHamburder.astro";
import SubMenuContainer from "./Submenu/Submenu.astro";
---

<nav id="navBar" class="navBarWrapper">
    <div class="logoContainer">
        <LogoIcon/>
        <img src="/logo.ico" style="width: 60px;"/>
        <a href="/" style="position: absolute; width: 100%; height: 100%; z-index:1"></a>

    </div>
    <div class="navBarContainer">
        <!-- <NavBarItem dataId="Future"><div class="fullWidthTileContent"><a href="/future">Przyszłe projekty</a></div></NavBarItem> -->
        <NavBarItem dataId="Server"><div class="fullWidthTileContent"><a href="/">Serwer</a></div></NavBarItem>
        <NavBarItem dataId="Archive"><div class="fullWidthTileContent"><a href="/archive">Archiwum eventów</a></div></NavBarItem>
        <NavBarItem dataId="Shop"><div class="fullWidthTileContent"><a href="/shop">Sklep</a></div></NavBarItem>
        <NavBarItem dataId="Contact"><div class="fullWidthTileContent"><a href="/contact">Kontakt</a></div></NavBarItem>
    </div>
    <MobileMenuHamburder/>
    <MobileMenu/>

    <SubMenuContainer>
        
    </SubMenuContainer>
</nav>


<script>

    function generateSubmenuHTML(menuItems) {
        return `<div class="submenuText">
            ${menuItems.map(item => {
                if(item?.type === "header"){
                    return `<h2>${item.label}</h2>`;
                }else if(item?.type === "subheader"){
                    return `<h3>${item.label}</h3>`;
                }else{
                    return `<div class="fullWidthTileContent" style="width:fit-content;"><a href="${item.href}">${item.label}</a></div>`;
                }
            }).join('')}
        </div>`;
    };

    const serverSubmenus = [
        {label: "Tryby Minecrafthex", type: "subheader"},
        {label: "Hex Event", href: "/hexEvent"},
        {label: "Hex Mini-Games", href: "/hexMiniGames"},
        {label: "Hex Economy SMP", href: "/hexSMP"},
    ]

    const contactSubmenus = [
        {label: "Kim jesteśmy", type: "subheader"},
        {label: "O nas", href: "/about"},
        {label: "Informacje", type: "subheader"},
        {label: "Kontakt", href: "/contact"},
    ];

    const contentMap = {
        Server: generateSubmenuHTML(serverSubmenus),
        Contact: generateSubmenuHTML(contactSubmenus)
    };

    const setSubmenuContent = (id: String, submenu: HTMLElement) => {
        const previousHeight = submenu.offsetHeight + "px";
        submenu.innerHTML = contentMap[id] ? `
            <div id="submenuContent" class="submenuContentWrapper">
                ${contentMap[id] || ""}
            </div>
        `: ``;

        const submenuContent = submenu.getElementsByClassName("submenuContentWrapper")[0];

        contentMap[id] ? submenu.classList.add("active") : submenu.classList.remove("active");
        submenu.style.height = previousHeight;

        submenu.offsetHeight;

        const newHeight = submenuContent.scrollHeight + 1 +"px";// +  + "px";
        submenu.style.height = newHeight;
        submenuContent.classList.add("fade-in");

 

    }

    const hideSubmenu = (submenu: HTMLElement) => {
        submenu.classList.remove("active");
        submenu.style.height = "0";
    }

    const hadnleNavBarSubmenu = () => {
        const navBar = document.querySelector("#navBar");
        const navItems = document.querySelectorAll("[data-id]");
        const submenu = document.getElementById("submenuContainer");
    
        if(submenu && navBar) {
            navItems.forEach((item) => {
            item.addEventListener("mouseenter", () => {
                const id = item.getAttribute("data-id");
                if(id){
                    submenu.classList.add("active");
                    setSubmenuContent(id, submenu );
                    
                }
                
            });

            });
            navBar.addEventListener("mouseleave", () => hideSubmenu(submenu));
        } 
    }
    document.addEventListener("DOMContentLoaded", () => {
        hadnleNavBarSubmenu();

        const toggle = document.getElementById("mobileMenuToggle");
        const mobileMenu = document.getElementById("mobileMenu");

        if (toggle && mobileMenu) {
            toggle.addEventListener("click", () => {
                mobileMenu.classList.toggle("active");
                document.body.classList.toggle("no-scroll");
            });

            document.querySelectorAll('#mobileMenu a').forEach(link => {
            link.addEventListener('click', () => {
            mobileMenu.classList.remove('active');
            document.body.classList.remove('no-scroll');
  });
});
        }
    });
</script>

<script>
  const nav = document.querySelector('nav');
  let lastScrollY = window.scrollY;
  let hideTimeout = null;
  let isCursorNearTop = false;

  function showNav() {
    nav.classList.remove('hidden');
  }

  function hideNav() {
    nav.classList.add('hidden');
  }

  function resetHideTimer() {
    clearTimeout(hideTimeout);
  }

  function startHideTimer() {
        resetHideTimer();
        hideTimeout = setTimeout(() => {
            hideNav();
        }, 3000);
  }

  function temporarilyShowNav() {
    showNav();
    startHideTimer();
  }

  function shouldHandleBehavior() {
    return window.innerWidth < 950;
  }

  // Scroll
  window.addEventListener('scroll', () => {
    if (!shouldHandleBehavior()) return;

    const currentScrollY = window.scrollY;
    const scrollingUp = currentScrollY < lastScrollY;
    const isAtTop = currentScrollY <= 60;

    if (isAtTop) {
      showNav();
      resetHideTimer();
    } else if (!scrollingUp) {
      hideNav();
      resetHideTimer();
    } else {
      temporarilyShowNav();
    }

    lastScrollY = currentScrollY;
  });

  // Kliknięcie lub najechanie
  nav.addEventListener('click', () => {
    if (!shouldHandleBehavior()) return;
    resetHideTimer();
  });

  nav.addEventListener('mouseenter', () => {
    if (!shouldHandleBehavior()) return;
    resetHideTimer();
  });

  nav.addEventListener('mouseleave', () => {
    if (!shouldHandleBehavior()) return;
    startHideTimer();
  });

  // Szerokość okna
  window.addEventListener('resize', () => {
    if (!shouldHandleBehavior()) {
      resetHideTimer();
      showNav();
    }
  });

  // ✨ Kursor blisko górnej krawędzi
  window.addEventListener('mousemove', (e) => {
    if (!shouldHandleBehavior()) return;

    if (e.clientY <= 50) {
      isCursorNearTop = true;
      showNav();
      resetHideTimer();
    } else {
      isCursorNearTop = false;
    }
  });
</script>


<style>
    nav{
        display: flex;
        background-color: white;
        z-index: 10;
        transition: transform 0.3s ease;
        transform: translateY(0);
    }

    nav.hidden {
        transform: translateY(-100%);
    }

    .logoContainer{
        position: relative;
        height: 100%;
        width: 62px;
        z-index: 3;
    }
    .navBarWrapper{
        position: fixed;
        top: 0;
        width: 100%;
        height: 60px;
        justify-content: center;
        gap: 30px;
    }
    .navBarContainer{
        display: flex;
        align-items: center;
        position: relative;
        height: 100%;
        background-color: var(--background-color);
        gap: 35px;
    }

    @media (max-width: 950px) {
        .navBarWrapper{
            justify-content: flex-start;
        }
        .navBarContainer{
            display: none;
        }
    }


</style>